#### VPC(Virtual Private Cloud)

- 네트워크 계층

- EC2 인스턴스를 비롯한 여러 AWS 서비스의 리소스를 담을 수 있는 가상 네트워크

- 한  AWS 리전 안에서만 존재할 수 있고, 한 리전에 만든 VPC는 다른 리전에서는 보이지 않음

- 연속적인 IP 주소 범위로 구성 => CIDR 블록으로 표시

  ~~~~
  10.0.0.0/8 	 ⇒ 10.0.0.0 ~ 10.255.255.255
  172.16.0.0/12  ⇒ 172.16.0.0 ~ 172.31.255.255
  192.168.0.0/16 ⇒ 192.168.0.0 ~ 192.168.255.255
  ~~~~

  

#### 서브넷(Subnet)

- VPC 내 논리 컨테이너
- EC2 인스턴스를 배치하는 장소 = 인스턴스는 서브넷 안에 위치
  - 한번 서브넷에 인스턴스를 생성하면 다른 서브넷으로 옮길 수 없음
  - 인스턴스를 종료하고 다른 서브넷 새 인스턴스 생성은 가능

- 인스턴스를 서로 격리하고 , 인스턴스 간의 트래픽 흐름을 제어하고, 인스턴스를 기능별로 묶을 수 있음

- 서브넷 CIDR 블록

  - VPC의 일부, VPC 내에서는 유니크 해야 함

  - 모든 서브넷에서 처음 4개의  IP와 마지막 1개는 예약되어 있으므로 인스턴스에 할당할 수 없음

    ~~~~
    예: 서브넷 CIDR이 172.16.100.0/24인 경우 
    			172.16.100.0 ~ 172.16.100.3 
    			172.16.100.255
    ~~~~

  - 서브넷은 하나의 가용영역(Available Zone, AZ) 내에서만 존재할 수 있음

    

#### ENI(Elastic Network Interface: 탄력적 네트워크 인터페이스)

- 물리 서버의 네트워크 인터페이스와 같은 기능을 수행

  

#### 인터넷 게이트웨이 (IGW)

- 퍼블릭 IP 주소를 할당받은 인스턴스가 인터넷과 연결돼서 요청을 수신할 수 있도록 기능을 제공
- 처음 VPC를 만들면 인터넷 게이트웨이가 연결되어 있지 않으므로, 직접 인터넷 게이트웨이를 만들고 VPC와 연결해야 함
- 하나의 VPC는 하나의 인터넷 게이트웨이만 연결할 수 있음

#### 라우팅

- VPC는 소프트웨어 함수로 IP 라우팅을 구현 ⇒ 사용자는 라우팅 테이블만 관리

- 라우팅 테이블 -> 하나 이상의 라우팅과 하나 이상의 서브넷 연결로 구성

  ~~~~
  - 기본 라우팅 : 인터넷 게이트웨이를 가리키는 라우팅
  대상 주소    				대상
  0.0.0.0/0     				igw-xxxxxxxxx
   	~~~~~~~~~				~~~~~~~~~~~~~
  	인터넷 상의 모든 호스트 IP를 기반	인터넷 게이트웨이
  기본 라우팅이 포함된 라우팅 테이블과 연결된 서브넷 ⇒ 퍼블릿 서브넷 
  기본 라우팅이 포함된 라우팅 테이블과 연결되지 않은 서브넷 ⇒ 프라이빗 서브넷
  
  
  	대상 주소				대상
  	172.31.0.0/16				LOCAL
  	0.0.0.0/0				igw-xxxxxxxxx
  
  	198.51.100.50으로 패킷을 보낼려고 하면, … 
  	라우팅할 위치와 가장 근접하게 일치하는 항목을 기반으로 라우팅을 처리하므로, 인터넷 게이트웨이로 라우팅됨
  
  	⇒ 라우팅 테이블의 항목들간의 순서는 중요하지 않음
  
  ~~~~

  

#### CREATING A basic VPC and associated components

- 목표 : vpc만들고 서브넷 만들고, igw 연결하고, 여러개의 서브넷을 가용영역(az)으로  생성

  ~~~~ 
  172.16.0.0/16 		⇒ 172.16.0.0 ~ 172.16.255.255
  1111 1111 1111 111 0000 0000 0000 0000
  
  ~~~~

- 가용영역에다 퍼블릭1만든다
- IPv4 CIDR 블록* : 172.16.1.0/24 : 서브넷 ip 내부에 
- ![image-20201006105841025](C:\Users\i\AppData\Roaming\Typora\typora-user-images\image-20201006105841025.png)

- 아직 서브넷 이랑  gw 연결안되서 이름 안뜸

-  인바운드규칙 : nacl 규칙 순위 오름차순, 허용하는 것들만 

-  아웃바운드규칙: 1024-65535는 랜덤포트, 이전의 포트는 지정된 포트로 사용불가

- 인바운드 : 들어오는 포트

- 아웃바운드 : 나가는 포트

  ![image-20201006112927632](C:\Users\i\AppData\Roaming\Typora\typora-user-images\image-20201006112927632.png)





- 서브넷 만들고 시작했고 , 여기는 다만들고 제한 걸음//?

#### Building a Three-Tier Network VPC from Scratch in AWS 

- 퍼블릭 ip 할당 : 외부와통신할 수 있도록 제공, 이것은 ip가 유동적, 지속적 서비스는 불가, 이것을 보완 -> 탄력적ip 

- vpc -> 서브넷6개 : 2개 가용영역에 3개 레이어 -> 2 게이트웨이 통 2 내부망 2 내부망 -> 인터넷게이트웨이 생성 -> 라우팅 테이블 생성 퍼블릭. 프라이빗 만들기 ->   .. 통신 안됨
- 구조만 만듦
- 하나의 vpc에는 하나의 gw,  그래서 다른 nat gw 통해 빠져나가게 만들 수 있다. 

107.23.33.235

#### 중간거 자소서 쓰느라 못함 나중에 다시

#### Troubleshooting AWS Network Connectivity: Security Groups and NACLs

#### Create a Linux EC2 Instance in AWS and Connect Using SSH

- 사용자는 ec2머신에 접근해서 작업
- ami 앞 운영체제 뒤 소프트웨어
- vpc -> 서브넷 -> ec2 -> 웹서버 데몬

